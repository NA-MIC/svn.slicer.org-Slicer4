
if(UNIX)
  
  EXECUTE_PROCESS( 
    COMMAND make
    WORKING_DIRECTORY "@python_base@"
    RESULT_VARIABLE rv
    )
      
  if(APPLE)
    # Special Slicer hack to build and install the .dylib

    #  if { $isDarwin } {
    #            # Special Slicer hack to build and install the .dylib
    #            file mkdir $::Slicer3_LIB/python-build/lib/
    #            file delete -force $::Slicer3_LIB/python-build/lib/libpython2.6.dylib
    #            set fid [open environhack.c w]
    #            puts $fid "char **environ=0;"
    #            close $fid
    #            runcmd gcc -c -o environhack.o environhack.c
    #            runcmd libtool -o $::Slicer3_LIB/python-build/lib/libpython2.6.dylib -dynamic  \
    #                -all_load libpython2.6.a environhack.o -single_module \
    #                -install_name $::Slicer3_LIB/python-build/lib/libpython2.6.dylib \
    #                -compatibility_version 2.6 \
    #                -current_version 2.6 -lSystem -lSystemStubs
    #
    #
  
    EXECUTE_PROCESS(
      COMMAND ${CMAKE_COMMAND} -E make_directory  "@python_build@/lib"
      WORKING_DIRECTORY "@python_build@"
      RESULT_VARIABLE rv
      )
      
    FILE(WRITE "@python_base@/environhack.c" "char **environ=0;")

    EXECUTE_PROCESS( 
      COMMAND gcc -c -o environhack.o environhack.c
      WORKING_DIRECTORY "@python_base@"
      RESULT_VARIABLE rv
      )
      
    EXECUTE_PROCESS( 
      COMMAND libtool -o "@python_build@/lib/libpython2.6.dylib" -dynamic -all_load libpython2.6.a environhack.o -single_module -install_name "@python_build@/lib/libpython2.6.dylib" -compatibility_version 2.6 -current_version 2.6 -lSystem -lSystemStubs
      WORKING_DIRECTORY "@python_base@"
      RESULT_VARIABLE rv
      )
  endif()
endif()

